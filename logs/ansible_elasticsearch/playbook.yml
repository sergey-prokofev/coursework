---
- name: install_elasticsearch
  hosts: host
  become: yes
  become_method: sudo
  remote_user: admin
  tasks:
    - name: apt update
      ansible.builtin.shell:
        apt update

    - name: Install elasticsearch repository
      ansible.builtin.shell: |
        wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch &&
        echo "deb [trusted=yes] https://mirror.yandex.ru/mirrors/elastic/7/ stable main" | sudo tee /etc/apt/sources.list.d/elastic-7.x.list &&
        apt update

    - name: install elasticsearch
      apt:
        name: "{{item}}"
        state: present
        update_cache: yes
      loop:
        - gnupg
        - apt-transport-https 
        - elasticsearch

    - name:  Start elasticsearch
      ansible.builtin.shell: |
        systemctl daemon-reload &&
        systemctl enable elasticsearch.service &&
        systemctl start elasticsearch.service
